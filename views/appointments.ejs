<h2>Rendez-vous</h2>

<a href="/appointments/new" class="btn btn-add">Ajouter un rendez-vous</a>

<table class="appointments-table">
  <thead>
    <tr>
      <th>Client</th>
      <th>Responsable</th>
      <th>Date et heure</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <% appointments.forEach(a => { %>
      <tr>
        <td>
          <% if (a.Clients && a.Clients.length) { %>
            <%= a.Clients.map(c => c.name).join(', ') %>
          <% } else { %>
            —
          <% } %>
        </td>

        <td>
          <%= a.User ? a.User.name : '—' %>
        </td>

        <td>
          <%= a.datetime ? new Date(a.datetime).toLocaleString() : '—' %>
        </td>

        <td class="actions">
          <% if (currentUser && a.userId === currentUser.id) { %>
            <a href="/appointments/<%= a.id %>/edit" class="btn btn-edit">Modifier</a>

            <form action="/appointments/<%= a.id %>?_method=DELETE" method="POST" style="display:inline;">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button type="submit" class="btn btn-delete">Supprimer</button>
            </form>
          <% } else { %>
            <span>—</span>
          <% } %>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>
